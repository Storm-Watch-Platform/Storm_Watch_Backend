// ---------- worker/ai_worker.go ----------
package worker

import (
	"context"
	"log"

	"github.com/Storm-Watch-Platform/Storm_Watch_Backend/usecase"
)

type AIWorker struct {
	queue     *AIQueue
	aiUseCase *usecase.AIUseCase
}

func NewAIWorker(q *AIQueue, uc *usecase.AIUseCase) *AIWorker {
	return &AIWorker{
		queue:     q,
		aiUseCase: uc,
	}
}

func (w *AIWorker) Start() {
	w.queue.Start()
}

func (w *AIWorker) Enqueue(reportID string) {
	w.queue.Push(AIJob{
		Priority: 1,
		Exec: func() {
			err := w.aiUseCase.EnrichReport(context.Background(), reportID)
			if err != nil {
				log.Printf("[AIWorker] Enrich fail for report=%s, err=%v\n", reportID, err)
			}
		},
	})
}
